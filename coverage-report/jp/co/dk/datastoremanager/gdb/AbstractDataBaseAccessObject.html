<!DOCTYPE html>
<html>
<head>
  <title>AbstractDataBaseAccessObject.java</title>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <link rel='stylesheet' type='text/css' href='../../../../../coverage.css'/>
  <link rel='shortcut icon' type='image/png' href='../../../../../logo.png'/>
  <script type='text/javascript' src='../../../../../coverage.js'></script>
  <script type='text/javascript' src='../../../../../prettify.js'></script>
</head>
<body onload='prettyPrint()'>
  <table cellpadding='0' cellspacing='1'>
    <caption>DataStoreManager/src/main/java/jp/co/dk/datastoremanager/gdb/AbstractDataBaseAccessObject.java</caption>
    <tr>
      <td class='line'>1</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>package jp.co.dk.datastoremanager.gdb;</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'></td><td>&nbsp;</td>
      <td><pre class='imports prettyprint' onclick='showHideLines(this)'><div>import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import jp.co.dk.datastoremanager.DataAccessObject;
import jp.co.dk.datastoremanager.DataBaseDriverConstants;
import jp.co.dk.datastoremanager.DataStore;
import jp.co.dk.datastoremanager.exception.DataStoreManagerException;
import jp.co.dk.datastoremanager.gdb.DataBaseNode;
import jp.co.dk.datastoremanager.gdb.DataConvertable;
import jp.co.dk.logger.Logger;
import jp.co.dk.logger.LoggerFactory;
import static jp.co.dk.datastoremanager.message.DataStoreManagerMessage.*;
</div><span>import ...</span></pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'></td><td>&nbsp;</td>
      <td class='comment' onclick='showHideLines(this)'><div>/**
 * AbstractDataBaseAccessObjectは、データベースにアクセスを行うデータアクセスオブジェクトが実装する基底クラスです。&lt;p/>
 * 
 * このクラスはデータストアオブジェクトを内包し、そのデータストアに対してselect、insert、update、deleteを行います。&lt;br/>
 * 例えば、"ORACLE"の"USERS"テーブルにアクセスする場合、"USERS"テーブルにアクセスするクラスを作成し、本クラスを継承し、その中でSQLオブジェクトを作成、&lt;br/>
 * このメソッドのアクセスメソッドを使用することでSQLを実行、結果の取得をおこなうことができる。
 * 
 * @version 1.0
 * @author D.Kanno
 */</div><span>/*...*/</span></td>
    </tr>
    <tr>
      <td class='line'>28</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>public abstract class AbstractDataBaseAccessObject implements DataAccessObject{</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>30</td><td>&nbsp;</td>
      <td><pre class='comment'>	/** データストアオブジェクト */</pre></td>
    </tr>
    <tr>
      <td class='line'>31</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	protected DataBaseDataStore dataStore;</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>33</td><td>&nbsp;</td>
      <td><pre class='comment'>	/** ロガーインスタンス */</pre></td>
    </tr>
    <tr>
      <td class='line'>34</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	protected Logger logger = LoggerFactory.getLogger(this.getClass());</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'></td><td>&nbsp;</td>
      <td class='comment' onclick='showHideLines(this)'><div>	/**
	 * コンストラクタ&lt;p/>
	 * 以下のパラメータを元に、データベースアクセスオブジェクトを生成、トランザクションを開始する。&lt;br/>
	 * &lt;br/>
	 * パラメータが不足している場合、またはトランザクション開始に失敗した場合、例外が送出される。&lt;br/>
	 * &lt;br/>
	 * ・データベースドライバー&lt;br/>
	 * ・データベース接続先URLまたは、IPアドレス&lt;br/>
	 * 
	 * @param driver   データベースドライバー
	 * @param url      データベース接続先URLまたは、IPアドレス
	 * @throws DataStoreManagerException パラメータが不足している場合、またはトランザクション開始に失敗した場合
	 */</div><span>	/*...*/</span></td>
    </tr>
    <tr>
      <td class='line'>49</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	protected AbstractDataBaseAccessObject(DataBaseDriverConstants driver, String url) throws DataStoreManagerException {</pre></td>
    </tr>
    <tr>
      <td class='line'>50</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		this(new DataBaseAccessParameter(driver.getDataStoreKind(), driver, url));</pre></td>
    </tr>
    <tr>
      <td class='line'>51</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'></td><td>&nbsp;</td>
      <td class='comment' onclick='showHideLines(this)'><div>	/**
	 * コンストラクタ&lt;p/>
	 * 以下のパラメータを元に、データベースアクセスオブジェクトを生成、トランザクションを開始する。&lt;br/>
	 * &lt;br/>
	 * パラメータが不足している場合、またはトランザクション開始に失敗した場合、例外が送出される。&lt;br/>
	 * &lt;br/>
	 * ・データベースドライバー&lt;br/>
	 * ・データベース接続先URLまたは、IPアドレス&lt;br/>
	 * ・データベース接続先ユーザ&lt;br/>
	 * ・データベース接続先パスワード&lt;br/>
	 * 
	 * @param driver   データベースドライバー
	 * @param url      データベース接続先URLまたは、IPアドレス
	 * @param user     データベース接続先ユーザ
	 * @param password データベース接続先パスワード
	 * @throws DataStoreManagerException パラメータが不足している場合、またはトランザクション開始に失敗した場合
	 */</div><span>	/*...*/</span></td>
    </tr>
    <tr>
      <td class='line'>70</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	protected AbstractDataBaseAccessObject(DataBaseDriverConstants driver, String url, String user, String password) throws DataStoreManagerException {</pre></td>
    </tr>
    <tr>
      <td class='line'>71</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		this(new DataBaseAccessParameter(driver.getDataStoreKind(), driver, url, user, password));</pre></td>
    </tr>
    <tr>
      <td class='line'>72</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'></td><td>&nbsp;</td>
      <td class='comment' onclick='showHideLines(this)'><div>	/**
	 * コンストラクタ&lt;p/>
	 * 指定のデータベースアクセスパラメータを元に、データベースアクセスオブジェクトを生成、トランザクションを開始する。&lt;br/>
	 * &lt;br/>
	 * パラメータが不足している場合、またはトランザクション開始に失敗した場合、例外が送出される。&lt;br/>
	 * 
	 * @param dataBaseAccessParameter データアクセスパラメータ
	 * @throws DataStoreManagerException パラメータが不足している場合、またはトランザクション開始に失敗した場合
	 */</div><span>	/*...*/</span></td>
    </tr>
    <tr>
      <td class='line'>83</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	protected AbstractDataBaseAccessObject(DataBaseAccessParameter dataBaseAccessParameter) throws DataStoreManagerException {</pre></td>
    </tr>
    <tr>
      <td class='line'>84</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		this.logger.constractor(this.getClass(), dataBaseAccessParameter);</pre></td>
    </tr>
    <tr>
      <td class='line'>85</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		if (dataBaseAccessParameter == null) throw new DataStoreManagerException(DATA_ACCESS_OBJECT_IS_NOT_SET);</pre></td>
    </tr>
    <tr>
      <td class='line'>86</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		this.dataStore = new DataBaseDataStore(dataBaseAccessParameter);</pre></td>
    </tr>
    <tr>
      <td class='line'>87</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		this.dataStore.startTransaction();</pre></td>
    </tr>
    <tr>
      <td class='line'>88</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'></td><td>&nbsp;</td>
      <td class='comment' onclick='showHideLines(this)'><div>	/**
	 * コンストラクタ&lt;p/>
	 * 指定のデータストアオブジェクトを元に、データベースアクセスオブジェクトを生成する。&lt;br/>
	 * データストアがデータベース用データストアでなかった場合、例外が送出される。&lt;br/>
	 * &lt;br/>
	 * @param dataStore データストアオブジェクト
	 * @throws DataStoreManagerException データストアがデータベース用データストアでなかった場合
	 */</div><span>	/*...*/</span></td>
    </tr>
    <tr>
      <td class='line'>98</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	protected AbstractDataBaseAccessObject(DataStore dataStore) throws DataStoreManagerException {</pre></td>
    </tr>
    <tr>
      <td class='line'>99</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		this.logger.constractor(this.getClass(), dataStore);</pre></td>
    </tr>
    <tr>
      <td class='line'>100</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		if (!(dataStore instanceof DataBaseDataStore)) throw new DataStoreManagerException(FAILE_TO_CAST_DATA_STORE_OBJECT); </pre></td>
    </tr>
    <tr>
      <td class='line'>101</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		this.dataStore = (DataBaseDataStore)dataStore;</pre></td>
    </tr>
    <tr>
      <td class='line'>102</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'></td><td>&nbsp;</td>
      <td class='comment' onclick='showHideLines(this)'><div>	/**
	 * 指定のCypherを実行し、レコードを作成する。&lt;p/>
	 * レコード追加に失敗した場合、例外を送出する。
	 * 
	 * @param cypher 実行対象のCypherオブジェクト
	 * @throws DataStoreManagerException レコード追加に失敗した場合
	 */</div><span>	/*...*/</span></td>
    </tr>
    <tr>
      <td class='line'>111</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	public void execute(Cypher cypher) throws DataStoreManagerException {</pre></td>
    </tr>
    <tr>
      <td class='line'>112</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		this.dataStore.execute(cypher);</pre></td>
    </tr>
    <tr>
      <td class='line'>113</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'></td><td>&nbsp;</td>
      <td class='comment' onclick='showHideLines(this)'><div>	/**
	 * 指定のCypherを実行し、レコードを作成する。&lt;p/>
	 * レコード追加に失敗した場合、例外を送出する。
	 * 
	 * @param cypher 実行対象のCypherオブジェクト
	 * @throws DataStoreManagerException レコード追加に失敗した場合
	 */</div><span>	/*...*/</span></td>
    </tr>
    <tr>
      <td class='line'>122</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	public &lt;E extends DataConvertable> List&lt;E> executeWithRetuen(Cypher cypher, E convertable) throws DataStoreManagerException {</pre></td>
    </tr>
    <tr>
      <td class='line'>123</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		List&lt;E> resultList = new ArrayList&lt;E>();</pre></td>
    </tr>
    <tr>
      <td class='line'>124</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		ResultSet result = this.dataStore.execute(cypher);</pre></td>
    </tr>
    <tr>
      <td class='line'>125</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		try {</pre></td>
    </tr>
    <tr>
      <td class='line'>126</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			while (result.next()) {</pre></td>
    </tr>
    <tr>
      <td class='line'>127</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>				resultList.add((E)convertable.convert(new DataBaseNode(result)));</pre></td>
    </tr>
    <tr>
      <td class='line'>128</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			}</pre></td>
    </tr>
    <tr>
      <td class='line'>129</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			result.close();</pre></td>
    </tr>
    <tr>
      <td class='line'>130</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		} catch (SQLException e) {</pre></td>
    </tr>
    <tr>
      <td class='line'>131</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			throw new DataStoreManagerException(GET_RECORD_IS_FAILE, cypher.toString(), e);</pre></td>
    </tr>
    <tr>
      <td class='line'>132</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		}</pre></td>
    </tr>
    <tr>
      <td class='line'>133</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		return resultList;</pre></td>
    </tr>
    <tr>
      <td class='line'>134</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	}</pre></td>
    </tr>
    <tr>
      <td class='line'>135</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>}</pre></td>
    </tr>
  </table>
</body>
</html>
